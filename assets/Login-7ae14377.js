import{r as k,a0 as j,j as me,ag as s,o as ue,c as de,a as o,X as t,R as r,F as ce,W as pe,u as ge,a7 as H,V as w,ax as fe,ay as _e}from"./@vue-3b858b78.js";import{_ as we,__tla as he}from"./request-17319f00.js";import{a as l}from"./js-cookie-cf83ad76.js";import{e as ve}from"./jsencrypt-32ff7c06.js";import{u as ye}from"./vue-router-111722e5.js";import{_ as be,__tla as ke}from"./_plugin-vue_export-helper-fa45ef8d.js";import{a as h,E as p,__tla as xe}from"./element-plus-e3bcbdc2.js";import"./axios-bff3f665.js";import"./nprogress-60a86a5b.js";import"./ali-oss-f05aeb17.js";import"./js-encrypt-af0330d8.js";import"./lodash-es-3b111273.js";import"./@vueuse-dbe79a15.js";import"./@element-plus-ffae287f.js";import"./@popperjs-c45de710.js";import"./@ctrl-43a4208a.js";import"./dayjs-de8721ee.js";import"./async-validator-7f96df71.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import{__tla as Ce}from"./@floating-ui-dec9075e.js";let J,Ve=Promise.all([(()=>{try{return he}catch{}})(),(()=>{try{return ke}catch{}})(),(()=>{try{return xe}catch{}})(),(()=>{try{return Ce}catch{}})()]).then(async()=>{const W=""+new URL("../prison-logo.svg",import.meta.url).href;let m,I,U,A,T,L,E,O,F,N,P,R,q,D,K;m=v=>(fe("data-v-45be0016"),v=v(),_e(),v),I={class:"login-container"},U={class:"login-banner"},A={style:{margin:"auto"}},T={style:{color:"white"}},L={class:"login-box"},E=m(()=>o("div",{class:"avatar-box"},[o("img",{src:W,alt:"logo"})],-1)),O={class:"buttons"},F=m(()=>o("p",null,"\u6211\u4EEC\u4F7F\u7528\u672C\u5730\u5B58\u50A8\u8BB0\u5F55\u7684\u4FE1\u606F\u5982\u4E0B",-1)),N=m(()=>o("ul",null,[o("li",null,"\u60A8\u662F\u5426\u786E\u8BA4\u4E86\u672C\u7B56\u7565\u901A\u77E5"),o("li",null,"\u60A8\u5BF9\u660E\u4EAE\u6A21\u5F0F\u548C\u6697\u9ED1\u6A21\u5F0F\u7684\u9009\u62E9\u72B6\u6001")],-1)),P=m(()=>o("p",null,"\u6211\u4EEC\u5C06\u4F7F\u7528Cookie\u8BB0\u5F55\u7684\u4FE1\u606F\u5982\u4E0B",-1)),R=m(()=>o("ul",null,[o("li",null,"\u60A8\u7684\u786E\u8BA4\u767B\u5F55\u7684\u72B6\u6001"),o("li",null,"\u60A8\u7684\u7528\u6237\u89D2\u8272\u4FE1\u606F"),o("li",null,"\u60A8\u7684\u5177\u4F53\u4FE1\u606F,\u6839\u636E\u89D2\u8272\u4E0D\u540C\u5305\u62EC:\u6635\u79F0\u3001\u6240\u5C5E\u76D1\u6240\u3001\u4E2A\u4EBA\u5934\u50CF\u94FE\u63A5\u3001\u662F\u5426\u6B63\u5728\u6A21\u62DF\u4E2D\u7B49"),o("li",null,"\u60A8\u7684\u767B\u5F55\u7528\u552F\u4E00\u6807\u8BC6\u7B26")],-1)),q=m(()=>o("p",null,"\u5982\u679C\u60A8\u9009\u62E9\u4E86 ' \u8BB0\u4F4F\u6211 ' , \u5219Cookie\u4E2D\u4E0D\u4F1A\u8BB0\u5F55\u989D\u5916\u4FE1\u606F",-1)),D={class:"dialog-footer"},K={__name:"Login",setup(v){const d=ye(),x=30,z=30,B=7,G="\u76D1\u6240\u8B66\u5458\u5FC3\u7406\u4FDD\u969C\u4E0E\u7BA1\u7406\u7CFB\u7EDF",g=k(),i=j({username:"",password:"",rememberMe:!1}),C={accountNumber:"",password:""},Q=j({username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},{min:1,max:20,message:"\u8D26\u53F7\u957F\u5EA6\u4E3A1-20",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{min:4,max:20,message:"\u5BC6\u7801\u957F\u5EA6\u4E3A4-20",trigger:"blur"}]}),V=async a=>{a&&await a.validate(async(e,u)=>{e?await Y():p.error("\u9884\u6821\u9A8C\u672A\u901A\u8FC7,\u8BF7\u68C0\u67E5\u8F93\u5165")})},S=k(!1),Y=async()=>{if(!f.value){p.error("\u8BF7\u5148\u540C\u610F\u6211\u4EEC\u7684cookie\u7B56\u7565");return}try{S.value=!0,C.accountNumber=i.username,C.password=ve(i.password);const{data:a}=await we.post("/backstage-management-service/login",C);if(a.code!==2e3){p.error(a.msg);return}i.rememberMe?l.set("rememberMe",i.rememberMe,{expires:x}):l.remove("rememberMe"),l.set("person",JSON.stringify(a.data.person),{expires:x}),l.set("role",a.data.role,{expires:x});const e=new Date().getTime(),u=new Date(e+60*1e3*z);l.set("accessToken",a.data.accessToken,{expires:u}),l.set("refreshToken",a.data.refreshToken,{expires:B}),p.success("\u767B\u5F55\u6210\u529F"),a.data.role==="Admin"?await d.push("/admin/home"):a.data.role==="PrisonAdmin"?await d.push("/prison/home"):await d.push("/police/home")}catch{}finally{S.value=!1}},Z=a=>{a&&a.resetFields()},$=()=>{const a=navigator.userAgent.toLowerCase(),e=a.indexOf("chrome")!==-1,u=a.indexOf("safari")!==-1,M=a.indexOf("firefox")!==-1;if(e){const c=a.match(/chrome\/([\d.]+)/)[1];parseInt(c.split(".")[0])<89&&h({title:"\u517C\u5BB9\u6027\u95EE\u9898",message:'\u60A8\u7684\u6D4F\u89C8\u5668\u53EF\u80FD\u65E0\u6CD5\u6B63\u5E38\u4F7F\u7528\u5168\u90E8\u529F\u80FD\u3002\u6211\u4EEC\u63A8\u8350\u60A8\u4F7F\u7528<a href="https://www.google.com/chrome" style="text-decoration: none;color: black">89\u53CA\u4EE5\u4E0A\u7248\u672C\u7684Chrome\u6D4F\u89C8\u5668</a>\u4EE5\u5B8C\u6574\u5730\u4F7F\u7528\u6211\u4EEC\u7684\u529F\u80FD\u3002',type:"warning"})}else if(u){const c=a.match(/version\/([\d.]+)/)[1];parseInt(c.split(".")[0])<15&&h({title:"\u517C\u5BB9\u6027\u95EE\u9898",message:'\u60A8\u7684\u6D4F\u89C8\u5668\u53EF\u80FD\u65E0\u6CD5\u6B63\u5E38\u4F7F\u7528\u5168\u90E8\u529F\u80FD\u3002\u6211\u4EEC\u63A8\u8350\u60A8\u4F7F\u7528<a href="https://www.apple.com/safari/" style="text-decoration: none;color: black">15\u53CA\u4EE5\u4E0A\u7248\u672C\u7684Safari\u6D4F\u89C8\u5668</a>\u4EE5\u5B8C\u6574\u5730\u4F7F\u7528\u6211\u4EEC\u7684\u529F\u80FD\u3002',type:"warning"})}else M&&h({title:"\u517C\u5BB9\u6027\u95EE\u9898",dangerouslyUseHTMLString:!0,message:'\u60A8\u7684\u6D4F\u89C8\u5668\u53EF\u80FD\u65E0\u6CD5\u6B63\u5E38\u4F7F\u7528\u5168\u90E8\u529F\u80FD\u3002\u6211\u4EEC\u63A8\u8350\u60A8\u4F7F\u7528<a href="https://www.google.com/chrome" style="text-decoration: none;color: black">89\u53CA\u4EE5\u4E0A\u7248\u672C\u7684Chrome\u6D4F\u89C8\u5668</a>\u4EE5\u5B8C\u6574\u5730\u4F7F\u7528\u6211\u4EEC\u7684\u529F\u80FD\u3002',type:"warning"})};me(async()=>{ee(),$(),l.get("rememberMe")!==void 0&&l.get("manualExit")!==void 0&&l.get("role")!==void 0&&l.get("person")!==void 0&&l.get("manualExit")==="false"&&l.get("rememberMe")==="true"&&(l.get("role")==="Admin"?await d.push("/admin/home"):l.get("role")==="PrisonAdmin"?await d.push("/prison/home"):await d.push("/police/home"))});const f=k(!1),_=k(!1),ee=()=>{if(window.localStorage.getItem("confirmCookieStrategy")!==void 0&&window.localStorage.getItem("confirmCookieStrategy")==="true"){f.value=!0;return}h({title:"\u8BF7\u5148\u786E\u8BA4\u6211\u4EEC\u7684Cookie\u7B56\u7565",message:"\u70B9\u51FB\u6B64\u901A\u77E5\u7684\u4EFB\u610F\u4F4D\u7F6E\u6765\u67E5\u770B\u6211\u4EEC\u7684Cookie\u7B56\u7565",duration:0,type:"warning",onClick:()=>{_.value=!0}})},ae=()=>{window.localStorage.setItem("confirmCookieStrategy","true"),_.value=!1,f.value=!0,h.closeAll(),p.success("\u60A8\u5DF2\u540C\u610F\u6211\u4EEC\u7684Cookie\u7B56\u7565,\u8BF7\u7EE7\u7EED\u767B\u5F55")},te=()=>{window.localStorage.setItem("confirmCookieStrategy","false"),_.value=!1,f.value=!1,p.error("\u60A8\u62D2\u7EDD\u4E86\u6211\u4EEC\u7684Cookie\u7B56\u7565,\u5C06\u65E0\u6CD5\u767B\u5F55,\u8BF7\u91CD\u65B0\u67E5\u770B\u7B56\u7565\u6216\u9000\u51FA\u672C\u9875\u9762")};return(a,e)=>{const u=s("el-row"),M=s("User"),c=s("el-icon"),X=s("el-input"),y=s("el-form-item"),oe=s("Lock"),re=s("el-checkbox"),b=s("el-button"),le=s("el-tooltip"),se=s("el-form"),ie=s("el-card"),ne=s("el-dialog");return ue(),de(ce,null,[o("div",I,[o("div",U,[t(u,null,{default:r(()=>[o("div",A,[o("h1",T,pe(ge(G)),1)])]),_:1})]),o("div",L,[E,t(se,{"label-width":"0px",class:"login-form",model:i,ref_key:"loginFormRef",ref:g,rules:Q,"status-icon":""},{default:r(()=>[t(y,{prop:"username"},{default:r(()=>[t(X,{placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7",modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=n=>i.username=n)},{prefix:r(()=>[t(c,{class:"el-input__icon"},{default:r(()=>[t(M)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(y,{prop:"password"},{default:r(()=>[t(X,{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password","show-password":"",modelValue:i.password,"onUpdate:modelValue":e[1]||(e[1]=n=>i.password=n),onKeyup:e[2]||(e[2]=H(n=>V(g.value),["enter","native"]))},{prefix:r(()=>[t(c,{class:"el-input__icon"},{default:r(()=>[t(oe)]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(u,{class:"button-row",align:"middle"},{default:r(()=>[t(y,null,{default:r(()=>[t(re,{modelValue:i.rememberMe,"onUpdate:modelValue":e[3]||(e[3]=n=>i.rememberMe=n),onKeyup:e[4]||(e[4]=H(n=>V(g.value),["enter","native"]))},{default:r(()=>[w(" \u8BB0\u4F4F\u6211 ")]),_:1},8,["modelValue"])]),_:1}),o("div",O,[t(y,null,{default:r(()=>[t(le,{class:"box-item",effect:"light",content:"\u8BF7\u786E\u8BA4\u6211\u4EEC\u7684Cookie\u653F\u7B56",placement:"bottom",disabled:f.value},{default:r(()=>[t(b,{type:"primary",onClick:e[5]||(e[5]=n=>V(g.value)),loading:S.value},{default:r(()=>[w(" \u767B\u5F55 ")]),_:1},8,["loading"])]),_:1},8,["disabled"]),t(b,{type:"info",onClick:e[6]||(e[6]=n=>Z(g.value))},{default:r(()=>[w("\u91CD\u7F6E")]),_:1})]),_:1})])]),_:1})]),_:1},8,["model","rules"])])]),t(ne,{title:"\u6211\u4EEC\u7684Cookie\u7B56\u7565",modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=n=>_.value=n),center:""},{footer:r(()=>[o("span",D,[t(b,{type:"primary",onClick:ae},{default:r(()=>[w(" \u540C\u610F ")]),_:1}),t(b,{onClick:te},{default:r(()=>[w("\u62D2\u7EDD")]),_:1})])]),default:r(()=>[t(ie,null,{default:r(()=>[F,N,P,R,q]),_:1})]),_:1},8,["modelValue"])],64)}}},J=be(K,[["__scopeId","data-v-45be0016"]])});export{Ve as __tla,J as default};
