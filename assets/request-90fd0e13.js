import{a as h}from"./axios-bff3f665.js";import{a as r}from"./js-cookie-cf83ad76.js";import{r as t,__tla as d}from"./_plugin-vue_export-helper-ee39f1d1.js";import{N as m}from"./nprogress-60a86a5b.js";import{E as a,__tla as f}from"./element-plus-e3bcbdc2.js";let o,k=Promise.all([(()=>{try{return d}catch{}})(),(()=>{try{return f}catch{}})()]).then(async()=>{m.configure({easing:"ease",speed:1e3,showSpinner:!1,trickleSpeed:200,minimum:.3,parent:"body"});let u,n,l;u=()=>{m.start()},n=()=>{m.done()},o=h.create({baseURL:"http://123.249.5.227:8079/api"}),l=async()=>{try{if(r.get("refreshToken")===void 0)return a.error("\u81EA\u52A8\u5237\u65B0\u4EE4\u724C\u5931\u8D25,\u8BF7\u91CD\u65B0\u767B\u5F55"),r.remove("manualExit"),r.remove("accessToken"),r.remove("refreshToken"),delete o.defaults.headers.common.Authorization,await t.push("/login"),!1;o.defaults.headers.common.Authorization="Bearer "+r.get("refreshToken");const e=(await o.get("/backstage-management-service/token-refresh")).data;return e.code===2e3?(r.set("accessToken",e.data.accessToken,{expires:30}),r.set("refreshToken",e.data.refreshToken,{expires:30}),o.defaults.headers.common.Authorization="Bearer "+r.get("accessToken"),c=!0,!0):(a.error("\u81EA\u52A8\u5237\u65B0\u4EE4\u724C\u5931\u8D25,\u8BF7\u91CD\u65B0\u767B\u5F55\u6216\u518D\u6B21\u70B9\u51FB\u767B\u5F55"),r.remove("manualExit"),r.remove("accessToken"),r.remove("refreshToken"),delete o.defaults.headers.common.Authorization,await t.push("/login"),!1)}catch{return r.remove("manualExit"),r.remove("accessToken"),r.remove("refreshToken"),delete o.defaults.headers.common.Authorization,await t.push("/login"),!1}},o.interceptors.request.use(e=>(u(),r.get("accessToken")!==void 0&&(e.headers.Authorization="Bearer "+r.get("accessToken")),e),e=>Promise.reject(e));let c=!0;const i=async()=>{c?(c=!1,await l()):t.currentRoute.value.fullPath!=="/login"?(a.error("\u60A8\u7684\u8BBF\u95EE\u672A\u88AB\u6388\u6743,\u53EF\u80FD\u662F\u60A8\u7684\u8EAB\u4EFD\u9A8C\u8BC1\u5DF2\u8FC7\u671F,3\u79D2\u540E\u5C06\u8DF3\u8F6C\u81F3\u767B\u5F55\u9875\u9762"),setTimeout(()=>{r.remove("manualExit"),r.remove("accessToken"),r.remove("refreshToken"),t.push("/login").then(e=>e)},3e3)):(r.remove("accessToken"),r.remove("refreshToken"),a.error("\u60A8\u7684\u8BBF\u95EE\u672A\u88AB\u6388\u6743,\u53EF\u80FD\u662F\u60A8\u7684\u8EAB\u4EFD\u9A8C\u8BC1\u5DF2\u8FC7\u671F,\u8BF7\u91CD\u65B0\u767B\u5F55"))};o.interceptors.response.use(async e=>{if(n(),e.data.AccessKeyId!==void 0)return e;if(e.data.code===void 0)a.error("\u540E\u7AEF\u670D\u52A1\u5668\u5F02\u5E38,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458");else switch(e.data.code){case 2e3:return e;case 400:return a.error(e.data.msg),Promise.reject(e);case 4e3:if(e.data.msg==="Invalid JWT token")await i();else return a.error(e.data.msg),Promise.reject(e);break;case 4010:await i();break;case 4011:await i();break;case 4012:t.currentRoute.value.fullPath!=="/login"?(a.error("\u60A8\u7684\u8BBF\u95EE\u672A\u88AB\u6388\u6743,\u53EF\u80FD\u662F\u60A8\u7684\u8EAB\u4EFD\u5DF2\u88AB\u6CE8\u9500,\u8BF7\u60A8\u5728\u767B\u5F55\u9875\u9762\u91CD\u8BD5,3\u79D2\u540E\u5C06\u6267\u884C\u8DF3\u8F6C"),setTimeout(()=>{r.remove("manualExit"),r.remove("accessToken"),r.remove("refreshToken"),t.push("/login").then(s=>s)},3e3)):a.error(e.data.msg);break;case 4030:return a.error("\u60A8\u7684\u8BBF\u95EE\u672A\u88AB\u6388\u6743,\u53EF\u80FD\u662F\u60A8\u7684\u8EAB\u4EFD\u6743\u9650\u4E0D\u8DB3"),Promise.reject(e);case 4040:a.error("\u60A8\u7684\u8BF7\u6C42\u7684\u8D44\u6E90\u4E0D\u5B58\u5728,\u5F53\u524D\u9875\u9762\u5C06\u88AB\u5237\u65B0"),t.push(t.currentRoute.value.fullPath).then(s=>s);break;case 5e3:a.error("\u540E\u7AEF\u670D\u52A1\u5F02\u5E38,\u5F53\u524D\u9875\u9762\u5C06\u88AB\u5237\u65B0,\u82E5\u65E0\u6548\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),t.push(t.currentRoute.value.fullPath).then(s=>s);break;default:return e}},e=>(n(),a.error("\u540E\u7AEF\u670D\u52A1\u5668\u5F02\u5E38,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),Promise.reject(e)))});export{o as _,k as __tla};
